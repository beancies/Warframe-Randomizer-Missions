<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tenno Progression Matrix</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #2ea043; --btn: #21262d; --highlight: #58a6ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; }
        .upload-zone { border: 2px dashed #30363d; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 20px; cursor: pointer; }
        .btn-roll { background: var(--highlight); color: white; border: none; padding: 15px 30px; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.1em; }
        #result { background: var(--card); border: 1px solid #30363d; padding: 25px; border-radius: 12px; margin-top: 20px; display: none; border-left: 8px solid var(--highlight); }
        .category { text-transform: uppercase; font-size: 0.8em; color: #8b949e; letter-spacing: 1px; }
        .target { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .location { color: var(--accent); font-family: monospace; font-size: 1.1em; }
        .reason { margin-top: 15px; padding: 10px; background: rgba(88, 166, 255, 0.1); border-radius: 4px; border-left: 3px solid var(--highlight); }
    </style>
</head>
<body>

<div class="container">
    <h1>Progression Matrix</h1>
    <div class="upload-zone" id="dropZone">
        <p>Drop <strong>AlecaFrame JSON</strong> here</p>
        <input type="file" id="fileInput" accept=".json">
        <div id="fileStatus">Offline Mode (Random)</div>
    </div>

    <button class="btn-roll" onclick="generateObjective()">GENERATE OBJECTIVE</button>

    <div id="result">
        <div class="category" id="cCat">Category</div>
        <div class="target" id="cName">Target</div>
        <div class="location" id="cLoc">Location</div>
        <div class="reason" id="cReason">Reason</div>
    </div>
</div>

<script>
    // --- DATABASE: NON-RELIC ITEMS ---
    const DB = {
        frames: {
            "ATLAS": "Jordas Precept (Eris Boss)",
            "BARUUK": "Little Duck (Vox Solaris)",
            "CALIBAN": "Narmer Bounties (Cetus/Fortuna)",
            "CHROMA": "Quests / Junctions",
            "CITRINE": "Tyana Pass (Mars)",
            "DAGATH": "Abyssal Zone (Syndicate Beacons)",
            "DANTE": "Armatus (Deimos Disruption)",
            "EMBER": "Tethys (Saturn Boss)",
            "EXCALIBUR": "War (Mars Boss)",
            "FROST": "Exta (Ceres Boss)",
            "GAUSS": "Kelpie (Sedna Disruption)",
            "GRENDEL": "Arbitration Locators",
            "GYRE": "Zariman Bounties",
            "HARROW": "Defection / Kuva Survival",
            "HILDRYN": "Exploiter Orb (Vox Solaris)",
            "HYDROID": "Oro (Earth Boss)",
            "IVARA": "Spy Missions (All Tiers)",
            "JADE": "Brutus (Uranus Ascension)",
            "KHORA": "Sanctuary Onslaught",
            "KULLERVO": "Duviri (Kullervo's Hold)",
            "LAVOS": "Father (Entrati)",
            "MAG": "Iliad (Phobos Boss)",
            "MESA": "Mutalist Alad V (Eris)",
            "NEKROS": "Magnacidium (Deimos Boss)",
            "NEZHA": "Tenno Lab (Dojo)",
            "NIDUS": "Oestrus (Eris Salvage)",
            "NOVA": "Naamah (Europa Boss)",
            "NYX": "Phorid Manifestations",
            "OBERON": "Railjack Points of Interest",
            "PROTEA": "Granum Void (Corpus Ships)",
            "QORVEX": "Sanctum Anatomica Bounties",
            "REVENANT": "Nakak (Cetus Quest)",
            "RHINO": "Fossa (Venus Boss)",
            "SARYN": "Merrow (Sedna Boss)",
            "SEVAGOTH": "Void Storms (Railjack)",
            "STYANAX": "Chipper (Kahl's Garrison)",
            "TITANIA": "Silver Grove Quest",
            "TRINITY": "Ambulas (Pluto Boss)",
            "VALKYR": "Themisto (Jupiter Boss)",
            "VAUBAN": "Nightwave Store",
            "VORUNA": "Yuvarium (Lua Survival)",
            "WISP": "Ropalolyst (Jupiter Boss)",
            "WUKONG": "Tenno Lab (Dojo)",
            "XAKU": "Father (Entrati Bounties)",
            "YARELI": "Ventkids (Bash Lab)",
            "ZEPHYR": "Tenno Lab (Dojo)"
        },
        weapons: {
            "IGNIS WRAITH": "Chem Lab (Dojo)",
            "BUBONICO": "Bio Lab (Dojo)",
            "CEDO": "Father (Entrati)",
            "PHENMOR": "Cavalero (Zariman)",
            "LAETUM": "Cavalero (Zariman)",
            "FELARX": "Cavalero (Zariman)",
            "NATARUK": "New War Quest",
            "EPITAPH": "Railjack Void Storms",
            "DESPAIR": "Stalker Drop",
            "DREAD": "Stalker Drop",
            "HATE": "Stalker Drop",
            "WAR": "Shadow Stalker",
            "BROKEN WAR": "Second Dream Quest",
            "XORIS": "Deadlock Protocol Quest",
            "SHEEDU": "Erra Quest / Symbilists",
            "KORUM": "Narmer Bounties",
            "VERICRES": "Tenno Live Event / Market",
            "AMPREX": "Energy Lab (Dojo)",
            "LENZ": "Energy Lab (Dojo)",
            "ARCA PLASMOR": "Energy Lab (Dojo)",
            "LANKA": "Energy Lab (Dojo)"
        },
        syndicates: {
            "OSTRON": "Cetus (Earth)",
            "SOLARIS UNITED": "Fortuna (Venus)",
            "ENTRATI": "Necralisk (Deimos)",
            "HOLDFASTS": "Chrysalith (Zariman)",
            "CAVIA": "Sanctum Anatomica (Deimos)",
            "VOX SOLARIS": "Little Duck (Fortuna)",
            "NECRALOID": "Loid (Necralisk)"
        }
    };

    let owned = new Set();
    let mastered = new Set();
    let subsumed = new Set();
    let syndicateRanks = {};

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const data = JSON.parse(event.target.result);
            // Parse inventory
            (data.inventory || data).forEach(i => { if(i.Name) owned.add(i.Name.toUpperCase()); });
            // Parse mastery
            if(data.mastery) Object.keys(data.mastery).forEach(k => mastered.add(k.toUpperCase()));
            // Parse subsumes
            if(data.helminth?.subsumed) data.helminth.subsumed.forEach(s => subsumed.add(s.toUpperCase()));
            // Parse syndicates
            if(data.syndicates) syndicateRanks = data.syndicates;

            document.getElementById('fileStatus').innerText = "âœ… Account Synced";
        };
        reader.readAsText(e.target.files[0]);
    });

    function generateObjective() {
        let pool = [];

        // 1. Check Frames (Highest Weight)
        for (let f in DB.frames) {
            const hasMastery = mastered.has(f);
            const isSubsumed = subsumed.has(f);
            if (!hasMastery) {
                pool.push({ cat: "Warframe Mastery", name: f, loc: DB.frames[f], reason: "Missing Mastery Rank.", weight: 100 });
            } else if (!isSubsumed && !f.includes("PRIME")) {
                pool.push({ cat: "Helminth Subsume", name: f, loc: DB.frames[f], reason: "Mastered but not subsumed.", weight: 60 });
            }
        }

        // 2. Check Weapons (Medium Weight)
        for (let w in DB.weapons) {
            if (!mastered.has(w) && !owned.has(w)) {
                pool.push({ cat: "Weapon Mastery", name: w, loc: DB.weapons[w], reason: "Acquire for Mastery Rank points.", weight: 40 });
            }
        }

        // 3. Check Syndicates (Low Weight)
        for (let s in DB.syndicates) {
            const rank = syndicateRanks[s] || 0;
            if (rank < 5) {
                pool.push({ cat: "Syndicate Standing", name: s, loc: DB.syndicates[s], reason: `Currently Rank ${rank}. Reach Rank 5 for rewards.`, weight: 10 });
            }
        }

        // 4. Randomize
        let weighted = [];
        pool.forEach(p => { for(let i=0; i<p.weight; i++) weighted.push(p); });
        
        const win = weighted[Math.floor(Math.random() * weighted.length)];
        if(!win) return alert("No objectives found! You are a God-Tier Tenno.");

        document.getElementById('cCat').innerText = win.cat;
        document.getElementById('cName').innerText = win.name;
        document.getElementById('cLoc').innerText = win.loc;
        document.getElementById('cReason').innerText = win.reason;
        document.getElementById('result').style.display = 'block';
    }
</script>
</body>
</html>
