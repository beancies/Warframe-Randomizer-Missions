<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tenno Mastery Matrix 2026: Completionist Edition</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #2ea043; --btn: #1f6feb; --frame: #d2a8ff; --syndicate: #ff7b72; --sp: #f2c94c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 900px; width: 100%; }
        .upload-zone { border: 2px dashed #30363d; padding: 20px; text-align: center; border-radius: 12px; margin-bottom: 20px; background: #0d1117; cursor: pointer; transition: 0.2s; }
        .upload-zone:hover { border-color: var(--btn); background: #161b22; }
        .btn-roll { background: var(--btn); color: white; border: none; padding: 18px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.2em; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-roll:hover { background: #388bfd; transform: translateY(-2px); }
        #result { background: var(--card); border: 1px solid #30363d; padding: 30px; border-radius: 15px; margin-top: 25px; display: none; border-left: 10px solid var(--frame); position: relative; text-align: left; }
        .target { font-size: 2.5em; font-weight: bold; margin: 10px 0; color: #fff; letter-spacing: -1px; }
        .location { color: var(--accent); font-family: 'Courier New', monospace; font-size: 1.3em; margin-bottom: 20px; display: block; }
        .priority-badge { position: absolute; top: 20px; right: 20px; padding: 5px 12px; border-radius: 20px; font-size: 0.8em; font-weight: bold; text-transform: uppercase; border: 1px solid; }
        #statusInfo { margin-top: 15px; font-size: 0.9em; color: #8b949e; }
    </style>
</head>
<body>

<div class="container">
    <h1>Tenno Completionist Matrix 2026</h1>
    
    <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
        <p id="fileStatus">Drop or Click to Upload <strong>AlecaFrame JSON</strong></p>
        <input type="file" id="fileInput" accept=".json" style="display:none">
        <div id="statusInfo">Status: Awaiting Account Data...</div>
    </div>

    <button class="btn-roll" onclick="generateObjective()">GENERATE COMPLETIONIST GOAL</button>

    <div id="result">
        <span id="pBadge" class="priority-badge">Priority</span>
        <div id="cCat" style="color: #8b949e; text-transform: uppercase; font-size: 0.9em;">Category</div>
        <div class="target" id="cName">Target Item</div>
        <div class="location" id="cLoc">Source Location</div>
        <div id="cReason" style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; line-height: 1.5;">Reasoning</div>
    </div>
</div>

<script>
    // --- DATABASE: 2026 FULL ROSTER ---
    const ALL_FRAMES = [
        "ASH", "ATLAS", "BANSHEE", "BARUUK", "CALIBAN", "CHROMA", "CITRINE", "CYTE-09", "DAGATH", "DANTE", "EMBER", "EQUINOX", "EXCALIBUR", "FROST", "GARA", "GARUDA", "GAUSS", "GRENDEL", "GYRE", "HARROW", "HILDRYN", "HYDROID", "INAROS", "IVARA", "JADE", "KHORA", "KOUMEI", "KULLERVO", "LAVOS", "LIMBO", "LOKI", "MAG", "MESA", "MIRAGE", "NEKROS", "NEZHA", "NIDUS", "NOVA", "NYX", "OBERON", "OCTAVIA", "ORAXIA", "PROTEA", "QORVEX", "REVENANT", "RHINO", "SARYN", "SEVAGOTH", "STYANAX", "TEMPLE", "TITANIA", "TRINITY", "URIEL", "VALKYR", "VAUBAN", "VOLT", "VORUNA", "WISP", "WUKONG", "XAKU", "YARELI", "ZEPHYR", "NOKKO"
    ];

    const NON_RELIC_WEAPONS = [
        "IGNIS WRAITH", "BUBONICO", "HEMA", "ARCA PLASMOR", "LANKA", "AMPREX", "QUANTA", "SYBARIS", "DAIKYU", "ATTICA", "TORID", "CERATA", "PHAGE", "SCOLIAC", "ACRID", "MIOS", "DRAGON NIKANA", "JAT KITTAG", "KNUX", "SHAKU", "KESHEG", "FLUCTUS", "GRATTLER",
        "CEDO", "TRUMNA", "SEPULCHRUM", "MORGHA", "CORTEGE", "PHENMOR", "LAETUM", "FELARX", "PRAEDOS", "INNODEM", "MITER", "PANTHERA", "SEER", "TWIN GREMLINS", "STUG", "EPITAPH", "AMBASSADOR", "SPORELACER", "VERMICPLICER", "GAZE", "TOMBFINGER", "NATARUK", "CORUFELL", "STALTA", "QUASSUS", "VITRICA", "MAUSOLON"
    ];

    const SYNDICATES = [
        { name: "The Hex", loc: "Höllvania Mall (1999)" },
        { name: "Cavia", loc: "Sanctum Anatomica, Deimos" },
        { name: "The Holdfasts", loc: "Chrysalith, Zariman" },
        { name: "Steel Meridian", loc: "Any Relay" },
        { name: "Arbiters of Hexis", loc: "Any Relay" },
        { name: "Cephalon Suda", loc: "Any Relay" },
        { name: "The Perrin Sequence", loc: "Any Relay" },
        { name: "Red Veil", loc: "Any Relay" },
        { name: "New Loka", loc: "Any Relay" },
        { name: "Ostron", loc: "Cetus, Earth" },
        { name: "Solaris United", loc: "Fortuna, Venus" },
        { name: "Vox Solaris", loc: "Fortuna (Little Duck)" },
        { name: "Entrati", loc: "Necralisk, Deimos" },
        { name: "Necraloid", loc: "Necralisk (Loid)" }
    ];

    let mastered = new Set();
    let subsumed = new Set();
    let syndicateRanks = {};
    let spProgress = { completed: 0, total: 280 }; // Standard 2026 total

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const data = JSON.parse(event.target.result);
            mastered.clear();
            subsumed.clear();
            syndicateRanks = {};

            // 1. Recursive Mastery & SP Scan
            function scan(obj) {
                for (let k in obj) {
                    if (obj[k] && typeof obj[k] === 'object') {
                        if (obj[k].mastered === true || (obj[k].xp && obj[k].xp > 0)) {
                            mastered.add(k.toUpperCase().replace(/_/g, " ").trim());
                        }
                        // Check for Steel Path node completion if AlecaFrame provides it
                        if (k === "steelPath" || k === "SteelPath") {
                            spProgress.completed = obj[k].completedNodes || obj[k].Progress || 0;
                            spProgress.total = obj[k].totalNodes || 280;
                        }
                        scan(obj[k]);
                    }
                }
            }
            scan(data);

            // 2. Subsume Scan
            const subList = data.helminth?.subsumed || data.Helminth?.Subsumed || [];
            subList.forEach(s => subsumed.add(s.toUpperCase()));

            // 3. Syndicate Scan
            const synData = data.syndicates || data.Syndicates || {};
            for (let s in synData) {
                // AlecaFrame usually maps by name
                syndicateRanks[s.toLowerCase()] = synData[s].rank || synData[s].level || 0;
            }

            document.getElementById('statusInfo').innerText = `✅ SYNCED: Detected ${mastered.size} items & ${spProgress.completed} SP nodes.`;
            document.getElementById('fileStatus').innerText = "Data Loaded Successfully!";
        };
        reader.readAsText(e.target.files[0]);
    });

    function generateObjective() {
        let pool = [];

        // --- 1. FRAMES (Priority 100) ---
        ALL_FRAMES.forEach(f => {
            if (!mastered.has(f)) {
                pool.push({ name: f, loc: "See Codex/Wiki", cat: "Frame", prio: 100, reason: "Missing Base Frame Mastery (6,000 pts)." });
            } else if (!subsumed.has(f) && f !== "EXCALIBUR UMBRA") {
                pool.push({ name: f, loc: "Farm 2nd Copy", cat: "Helminth", prio: 40, reason: "Mastered, but not yet fed to Helminth." });
            }
        });

        // --- 2. WEAPONS (Priority 80) ---
        NON_RELIC_WEAPONS.forEach(w => {
            if (!mastered.has(w)) {
                pool.push({ name: w, loc: "Boss/Dojo/Quest", cat: "Weapon", prio: 80, reason: "Missing Weapon Mastery (3,000 pts)." });
            }
        });

        // --- 3. SYNDICATES (Priority 30) ---
        SYNDICATES.forEach(s => {
            const rank = syndicateRanks[s.name.toLowerCase()] || 0;
            if (rank < 5) {
                pool.push({ name: s.name, loc: s.loc, cat: "Syndicate", prio: 30, reason: `Rank ${rank}/5. Max standing for completionist status.` });
            }
        });

        // --- 4. STEEL PATH (Priority 10) ---
        if (spProgress.completed < spProgress.total) {
            pool.push({ 
                name: "Steel Path Node", 
                loc: "Star Chart (Steel Path Mode)", 
                cat: "Star Chart", 
                prio: 10, 
                reason: `Clear missing nodes. Progress: ${spProgress.completed}/${spProgress.total}.` 
            });
        }

        if (pool.length === 0) return alert("All targets achieved! You are a 100% Completionist in these categories.");

        // Weighted Selection
        let weighted = [];
        pool.forEach(p => { for(let i=0; i<p.prio; i++) weighted.push(p); });
        const win = weighted[Math.floor(Math.random() * weighted.length)];

        // Update UI
        document.getElementById('cCat').innerText = win.cat;
        document.getElementById('cName').innerText = win.name;
        document.getElementById('cLoc').innerText = win.loc;
        document.getElementById('cReason').innerText = win.reason;
        document.getElementById('pBadge').innerText = `Priority: ${win.prio}`;
        
        // Dynamic Badge Colors
        const colors = { 100: '#d2a8ff', 80: '#79c0ff', 40: '#58a6ff', 30: '#ff7b72', 10: '#f2c94c' };
        document.getElementById('pBadge').style.borderColor = colors[win.prio];
        document.getElementById('result').style.borderLeftColor = colors[win.prio];
        document.getElementById('result').style.display = 'block';
    }
</script>
</body>
</html>
