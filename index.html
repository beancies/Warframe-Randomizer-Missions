<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tenno Mastery Matrix 2026</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #2ea043; --btn: #1f6feb; --frame: #d2a8ff; --relic: #f2c94c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 900px; width: 100%; }
        .upload-zone { border: 2px dashed #30363d; padding: 20px; text-align: center; border-radius: 12px; margin-bottom: 20px; background: #0d1117; cursor: pointer; }
        .btn-roll { background: var(--btn); color: white; border: none; padding: 18px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.2em; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-roll:hover { background: #388bfd; transform: translateY(-2px); }
        #result { background: var(--card); border: 1px solid #30363d; padding: 30px; border-radius: 15px; margin-top: 25px; display: none; border-left: 10px solid var(--frame); position: relative; }
        .target { font-size: 2.5em; font-weight: bold; margin: 10px 0; color: #fff; letter-spacing: -1px; }
        .location { color: var(--accent); font-family: 'Courier New', monospace; font-size: 1.3em; margin-bottom: 20px; display: block; }
        .priority-badge { position: absolute; top: 20px; right: 20px; padding: 5px 12px; border-radius: 20px; font-size: 0.8em; font-weight: bold; text-transform: uppercase; }
        #statusInfo { margin-top: 15px; font-size: 0.9em; color: #8b949e; }
    </style>
</head>
<body>

<div class="container">
    <h1>Tenno Mastery Matrix</h1>
    
    <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
        <p id="fileStatus">Click to Upload <strong>AlecaFrame JSON</strong></p>
        <input type="file" id="fileInput" accept=".json" style="display:none">
        <div id="statusInfo">Status: Offline (Using Random Defaults)</div>
    </div>

    <button class="btn-roll" onclick="generateObjective()">GENERATE NEXT GOAL</button>

    <div id="result">
        <span id="pBadge" class="priority-badge">Priority</span>
        <div id="cCat" style="color: #8b949e; text-transform: uppercase; font-size: 0.9em;">Category</div>
        <div class="target" id="cName">Target Item</div>
        <div class="location" id="cLoc">Source Location</div>
        <div id="cReason" style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; line-height: 1.5;">Reasoning</div>
    </div>
</div>

<script>
    // --- JAN 2026 PRIME RESURGENCE (Rotation 2) ---
    // Priority: Middle (60)
    const UNVAULTED_DB = [
        { name: "NEKROS PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "HARROW PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "SARYN PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "VALKYR PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "IVARA PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "OBERON PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "GARUDA PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "KHORA PRIME", loc: "Varzia (Aya Relics)", cat: "Unvaulted" },
        { name: "TIGRIS PRIME", loc: "Relic Farm", cat: "Unvaulted Weapon" },
        { name: "NIKANA PRIME", loc: "Relic Farm", cat: "Unvaulted Weapon" },
        { name: "VENKA PRIME", loc: "Relic Farm", cat: "Unvaulted Weapon" },
        { name: "SYBARIS PRIME", loc: "Relic Farm", cat: "Unvaulted Weapon" }
    ];

    // --- STATIC MASTERY DB (Non-Relic) ---
    const STATIC_DB = [
        // Frames (100)
        { name: "DANTE", loc: "Armatus (Deimos)", cat: "Frame" },
        { name: "QORVEX", loc: "Effervo (Deimos)", cat: "Frame" },
        { name: "STYANAX", loc: "Kahl's Garrison", cat: "Frame" },
        { name: "VORUNA", loc: "Lua Conjunction", cat: "Frame" },
        { name: "CITRINE", loc: "Tyana Pass (Mars)", cat: "Frame" },
        { name: "KULLERVO", loc: "Duviri (Kullervo's Hold)", cat: "Frame" },
        { name: "DAGATH", loc: "Abyssal Zone", cat: "Frame" },
        // Dojo Weapons (80)
        { name: "IGNIS WRAITH", loc: "Chem Lab", cat: "Dojo" },
        { name: "BUBONICO", loc: "Bio Lab", cat: "Dojo" },
        { name: "PHENMOR", loc: "Zariman (Cavalero)", cat: "Zariman" },
        { name: "LAETUM", loc: "Zariman (Cavalero)", cat: "Zariman" },
        // Syndicates (10)
        { name: "CAVIA", loc: "Sanctum Anatomica", cat: "Syndicate" },
        { name: "HOLDFASTS", loc: "Zariman", cat: "Syndicate" },
        { name: "SOLARIS UNITED", loc: "Fortuna", cat: "Syndicate" }
    ];

    let mastered = new Set();
    let subsumed = new Set();

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const data = JSON.parse(event.target.result);
            mastered.clear();
            
            // DEEP SCAN: AlecaFrame often nests items inside sub-objects
            function scan(obj) {
                for (let k in obj) {
                    if (obj[k] && typeof obj[k] === 'object') {
                        // Check for Mastery/Rank flags
                        if (obj[k].mastered === true || obj[k].maxed === true || (obj[k].xp && obj[k].xp > 0)) {
                            mastered.add(k.toUpperCase().replace(/_/g, " ").trim());
                        }
                        scan(obj[k]);
                    }
                }
            }
            scan(data);
            
            // Standard Helminth check
            const subList = data.helminth?.subsumed || data.Helminth?.Subsumed || [];
            subList.forEach(s => subsumed.add(s.toUpperCase()));

            document.getElementById('statusInfo').innerText = `âœ… SYNCED: Detected ${mastered.size} Mastered items.`;
            document.getElementById('fileStatus').innerText = "Account Data Loaded!";
        };
        reader.readAsText(e.target.files[0]);
    });

    function generateObjective() {
        let pool = [];

        // 1. Static Masterables (Prio: High 100/80)
        STATIC_DB.forEach(i => {
            if (!mastered.has(i.name)) {
                let prio = i.cat === "Frame" ? 100 : 80;
                if (i.cat === "Syndicate") prio = 10;
                pool.push({ ...i, prio: prio, reason: `Missing base ${i.cat} Mastery.` });
            }
        });

        // 2. Unvaulted Relics (Prio: Middle 60)
        UNVAULTED_DB.forEach(i => {
            if (!mastered.has(i.name)) {
                pool.push({ ...i, prio: 60, reason: "Currently UNVAULTED. Farm Varzia/Relics now!" });
            }
        });

        // 3. Subsume check (Prio: 40)
        STATIC_DB.filter(i => i.cat === "Frame").forEach(f => {
            if (mastered.has(f.name) && !subsumed.has(f.name)) {
                pool.push({ ...f, prio: 40, cat: "Helminth", reason: "Mastered but not yet fed to Helminth." });
            }
        });

        if (pool.length === 0) return alert("All current database items are mastered!");

        // Weighted Selection
        let weighted = [];
        pool.forEach(p => { for(let i=0; i<p.prio; i++) weighted.push(p); });
        const win = weighted[Math.floor(Math.random() * weighted.length)];

        document.getElementById('cCat').innerText = win.cat;
        document.getElementById('cName').innerText = win.name;
        document.getElementById('cLoc').innerText = win.loc;
        document.getElementById('cReason').innerText = win.reason;
        document.getElementById('pBadge').innerText = `Weight: ${win.prio}`;
        document.getElementById('result').style.display = 'block';
    }
</script>
</body>
</html>
