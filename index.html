<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tenno Completionist Matrix</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #2ea043; --btn: #21262d; --highlight: #58a6ff; --frame: #d2a8ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; }
        .upload-zone { border: 2px dashed #30363d; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 20px; cursor: pointer; background: #0d1117; }
        .btn-roll { background: var(--highlight); color: white; border: none; padding: 15px 30px; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.1em; transition: 0.2s; }
        .btn-roll:hover { background: #388bfd; }
        #result { background: var(--card); border: 1px solid #30363d; padding: 25px; border-radius: 12px; margin-top: 20px; display: none; border-left: 8px solid var(--frame); }
        .category { text-transform: uppercase; font-size: 0.8em; color: #8b949e; letter-spacing: 1px; }
        .target { font-size: 2.2em; font-weight: bold; margin: 10px 0; color: #fff; }
        .location { color: var(--accent); font-family: monospace; font-size: 1.2em; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .reason { padding: 12px; background: rgba(210, 168, 255, 0.1); border-radius: 4px; border-left: 3px solid var(--frame); color: #d2a8ff; }
        #statusInfo { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>Mastery Completionist</h1>
    <div class="upload-zone" id="dropZone">
        <p id="fileStatus">Select or Drop AlecaFrame JSON</p>
        <input type="file" id="fileInput" accept=".json">
        <div id="statusInfo"></div>
    </div>

    <button class="btn-roll" onclick="generateObjective()">GENERATE COMPLETIONIST GOAL</button>

    <div id="result">
        <div class="category" id="cCat">Category</div>
        <div class="target" id="cName">Target</div>
        <div class="location" id="cLoc">Location</div>
        <div class="reason" id="cReason">Reason</div>
    </div>
</div>

<script>
    // --- DATABASE: BASE ITEMS (The script will automatically check for Prime/Vandal variants) ---
    const BASE_DATA = {
        frames: ["ATLAS", "BARUUK", "CALIBAN", "CHROMA", "CITRINE", "DAGATH", "DANTE", "EMBER", "EXCALIBUR", "FROST", "GAUSS", "GRENDEL", "GYRE", "HARROW", "HILDRYN", "HYDROID", "IVARA", "JADE", "KHORA", "KULLERVO", "LAVOS", "MAG", "MESA", "NEKROS", "NEZHA", "NIDUS", "NOVA", "NYX", "OBERON", "PROTEA", "QORVEX", "REVENANT", "RHINO", "SARYN", "SEVAGOTH", "STYANAX", "TITANIA", "TRINITY", "VALKYR", "VAUBAN", "VORUNA", "WISP", "WUKONG", "XAKU", "YARELI", "ZEPHYR"],
        weapons: ["IGNIS", "BRATON", "LATO", "STRUN", "FURAX", "LEX", "BO", "KUNAI", "FURIS", "AFURIS", "SKANA", "BURSTON", "AKBOLTO", "BOLTO", "BOLTOR", "GORGON", "GRAKATA", "SILVA & AEGIS", "SYBARIS", "TIGRIS", "CERNOS", "NIKANA"]
    };

    const VARIANTS = ["PRIME", "VANDAL", "WRAITH", "PRISMA", "KUVA", "TENET", "UMBRA", "DEX", "MUTALIST"];

    let mastered = new Set();
    let subsumed = new Set();

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = JSON.parse(event.target.result);
                mastered.clear();
                subsumed.clear();

                // FIX: AlecaFrame structure mapping
                // Check if mastery is at top level or inside a 'Mastery' object
                const masteryList = data.mastery || data.Mastery || {};
                
                Object.keys(masteryList).forEach(itemName => {
                    // Aleca uses the full name as the key. We clean it and add it.
                    mastered.add(itemName.toUpperCase().trim());
                });

                // Check for Helminth subsumes
                const helminth = data.helminth || data.Helminth || {};
                const subsumeList = helminth.subsumed || helminth.Subsumed || [];
                subsumeList.forEach(s => subsumed.add(s.toUpperCase().trim()));

                const status = document.getElementById('statusInfo');
                status.innerText = `âœ… SYNC COMPLETE: Found ${mastered.size} Mastered Items.`;
                status.style.color = "#2ea043";
            } catch (err) {
                console.error(err);
                alert("Could not read JSON structure.");
            }
        };
        reader.readAsText(e.target.files[0]);
    });

    function generateObjective() {
        let pool = [];

        // 1. Process Frames & Variants
        BASE_DATA.frames.forEach(base => {
            // Check Base Frame
            if (!mastered.has(base)) {
                pool.push({ cat: "Frame Mastery", name: base, loc: "See Codex/Boss", reason: "Base frame mastery missing.", weight: 100 });
            } else if (!subsumed.has(base)) {
                pool.push({ cat: "Helminth", name: base, loc: "See Codex/Boss", reason: "Mastered, but not yet Subsumed.", weight: 50 });
            }

            // Check Variants (Ex: Khora Prime)
            VARIANTS.forEach(v => {
                let vName = `${base} ${v}`;
                if (v === "PRIME") vName = `${base} PRIME`; // Standardize
                
                // Special check for things like "Mutalist Alad V" vs "Mutalist Cernos"
                if (mastered.has(vName)) return; 
                
                // We add variants to the pool with a high weight because they are mastery
                // Note: This logic only adds them if they exist in the game.
                // For a true completionist tool, you'd eventually want a full list of every weapon.
                pool.push({ cat: "Variant Mastery", name: vName, loc: "Relics / Special", reason: "Missing unique variant mastery.", weight: 80 });
            });
        });

        // 2. Process Weapons
        BASE_DATA.weapons.forEach(base => {
            if (!mastered.has(base)) pool.push({ cat: "Weapon Mastery", name: base, loc: "Market/Dojo", reason: "Base weapon mastery missing.", weight: 40 });
            
            VARIANTS.forEach(v => {
                let vName = `${base} ${v}`;
                if (!mastered.has(vName)) {
                    pool.push({ cat: "Weapon Variant", name: vName, loc: "Various", reason: "Missing unique variant mastery.", weight: 30 });
                }
            });
        });

        // 3. Selection
        let weighted = [];
        pool.forEach(p => { for(let i=0; i<p.weight; i++) weighted.push(p); });
        const win = weighted[Math.floor(Math.random() * weighted.length)];

        if (!win) {
            alert("No missing items found in this database category!");
            return;
        }

        document.getElementById('cCat').innerText = win.cat;
        document.getElementById('cName').innerText = win.name;
        document.getElementById('cLoc').innerText = win.loc;
        document.getElementById('cReason').innerText = win.reason;
        document.getElementById('result').style.display = 'block';
    }
</script>
</body>
</html>
